{
    "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
    "apiVersion": "2022-09-01-preview",
    "name": "ZeroFoxAlertsDefinition",
    "location": "{{location}}",
    "kind": "Customizable",
    "properties": {
        "connectorUiConfig": {
            "id": "ZeroFoxAlerts",
            "title": "ZeroFox Enterprise - Alerts (using REST API)",
            "publisher": "ZeroFox Enterprise",
            "descriptionMarkdown": "The [ZeroFox Enterprise](https://www.zerofox.com/) data connector allows you to connect to your ZeroFox instance and ingest alerts into Microsoft Sentinel. The data connector is built on Microsoft Sentinel's Codeless Connector Platform and uses the ZeroFox API to fetch security alerts and supports DCR-based [ingestion time transformations](https://docs.microsoft.com/azure/azure-monitor/logs/custom-logs-overview) that parses the received security alert data into custom columns so that queries don't need to parse it again, thus resulting in better performance.",
            "graphQueriesTableName": "ZeroFoxAlerts_CL",
            "graphQueries": [
                {
                    "metricName": "Total alerts received",
                    "legend": "ZeroFox Alerts",
                    "baseQuery": "{{graphQueriesTableName}}"
                }
            ],
            "sampleQueries": [
                {
                    "description": "List all ZeroFox alerts",
                    "query": "{{graphQueriesTableName}}\n | sort by TimeGenerated desc"
                },
                {
                    "description": "Count alerts by threat source",
                    "query": "{{graphQueriesTableName}}\n | summarize Count = count() by ThreatSource"
                },
                {
                    "description": "Count alerts by entity",
                    "query": "{{graphQueriesTableName}}\n | summarize Count = count() by EntityName"
                },
                {
                    "description": "High severity alerts in last 24 hours",
                    "query": "{{graphQueriesTableName}}\n | where TimeGenerated >= ago(24h)\n | where Severity == \"High\"\n | sort by TimeGenerated desc"
                }
            ],
            "dataTypes": [
                {
                    "name": "{{graphQueriesTableName}}",
                    "lastDataReceivedQuery": "{{graphQueriesTableName}}\n   | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                }
            ],
            "connectivityCriteria": [
                {
                    "type": "HasDataConnectors"
                }
            ],
            "availability": {
                "isPreview": false
            },
            "permissions": {
                "resourceProvider": [
                    {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                            "write": true,
                            "read": true,
                            "delete": true
                        }
                    },
                    {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key)",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                            "action": true
                        }
                    }
                ],
                "customs": [
                    {
                        "name": "ZeroFox Personal Access Token (PAT)",
                        "description": "A ZeroFox PAT is required. You can get it in Data Connectors > [API Data Feeds](https://cloud.zerofox.com/data_connectors/api)."
                    }
                ]
            },
            "instructionSteps": [
                {
                    "description": "To enable the ZeroFox Alerts for Microsoft Sentinel, provide the required information below and click on Connect.",
                    "instructions": [
                        {
                            "type": "Textbox",
                            "parameters": {
                                "label": "ZeroFox API Token",
                                "placeholder": "Enter your ZeroFox Personal Access Token",
                                "type": "password",
                                "name": "apiToken"
                            }
                        },
                        {
                            "parameters": {
                                "label": "toggle",
                                "name": "toggle"
                            },
                            "type": "ConnectionToggleButton"
                        }
                    ],
                    "title": "Connect ZeroFox Alerts to Microsoft Sentinel"
                }
            ]
        }
    }
}
